!function(){"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var o=n.getElementsByTagName("script");o.length&&(t=o[o.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t+"../"}();e.p,e.p,e.p,e.p,e.p,e.p;const t="#000000",n="#8f99a8",o="#f5eace",r=.25,a=1,c=5,i="c8d6669b-2153-4780-b345-9be69d36fc9d",s="MAIN_MENU",l="SETTINGS_MENU",d="SPEED_SETTINGS_MENU",u="LEFT_EYE_COLOR_PICKER_MENU",g="RIGHT_EYE_COLOR_PICKER_MENU",p="BOARD_SIZE_SETTINGS_MENU",m="BLOCKS",h="GAME_OVER_STATE",f="BLOCKS_GAME_INITIAL",S="BLOCKS_GAME_PLAYING",w="BLOCKS_GAME_PAUSE",v="BLOCKS_GAME_OVER",E="MODE_ALTERNATE_SHAPES",b="MODE_ALTERNATE_CELLS",C={leftEyeColor:"rgb(255,0,0)",rightEyeColor:"rgb(0,0,255)",gridEnabled:!0,score:0,speedLevel:0,increaseSpeedLevel:!0,linesCleared:0,rows:15,columns:12,appState:null,shouldCallResizeOnDraw:!1,gameCanvas:null,gameCanvasWrapper:null,canvasContext:null,xMargin:0,yMargin:0,gridFacetSize:0,coloringMode:E,currentShape:null,nextShape:null,gameBoard:null,gameState:f,gameLogicTicksInterval:1e3,animationId:null,gameLogicId:null,gameLogicTimeoutId:null},L={...C},T=[];function y(e,t){Object.assign(L,e);const n=Object.keys(e);t&&T.forEach((e=>{let{properties:t,callback:o}=e;(t.some((e=>n.includes(e)))||0===t.length)&&o(L)}))}function k(e){y(e,!0)}function M(e){y(e,!1)}function x(){return L}function I(e,t){const n=Object.keys(L);e.forEach((e=>{if(!n.includes(e))throw new Error(`${e} is not key in the state.`)})),T.push({properties:e,callback:t})}function R(e){k({appState:e})}const B={currentState:null,map:{}};function O(e,t){Object.assign(B.map,t);I(["appState"],(e=>{let{appState:t}=e;if(t!==B.currentState){const e=document.getElementById("root");e.innerHTML="",e.appendChild(B.map[t]),B.currentState=t}})),k({appState:e})}function A(e){return e.classList}function _(e){return document.createElement(e)}window.cancelAnimationFrame||window.mozCancelAnimationFrame;const F=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||(e=>setTimeout(e,1e3/60));function N(e){return F(e)}function z(e){const t=_("div");return A(t).add("ui-menu"),e&&e.forEach((e=>t.appendChild(e))),t}function P(e,t){const n=_("button");return n.innerText=e,n.onclick=t,A(n).add("ui-menu-item"),n}function $(e){const t=_("button");return t.innerText=e,t.disabled=!0,A(t).add("ui-menu-title"),t}function D(e){const t=_("button");return t.innerText=e,t.disabled=!0,A(t).add("ui-menu-item-text"),t}const G=24,H=e=>e<12?`rgb(${255-21.25*e},0,0)`:`rgb(0,0,${21.25*(e-12)})`,j=e=>{const t=_("canvas");A(t).add("colorpicker");const n=t.getContext("2d"),o=t.width/25;for(let e=0;e<=G;e+=1)n.fillStyle=H(e),n.fillRect(e*o,0,o,t.height);return t.addEventListener("click",(n=>{let{clientX:o}=n;if(t){const{left:n,width:r}=t.getBoundingClientRect(),a=((e,t)=>{const n=t/25;let o=1;for(;e>n*o;)o+=1;return H(o-1)})(o-n,r);e(a)}})),t},U=e=>(e?"Disable":"Enable")+" grid";function q(){const e=P(U(x().gridEnabled),(()=>{const{gridEnabled:e}=x();k({gridEnabled:!e})}));return I(["gridEnabled"],(t=>{let{gridEnabled:n}=t;e&&(e.innerText=U(n))})),e}function K(e){const t=_("canvas");return A(t).add("color-indicator"),I([],(n=>{if(t){const o=e(n),r=t.getContext("2d");r.fillStyle=o,r.fillRect(0,0,t.width,t.height)}})),t}function W(e,t,n){const o=_("button");o.innerHTML="&plus;",o.onclick=e;const r=_("button");r.innerHTML="&minus;",r.onclick=t;const a=_("div");a.innerText=0,I([],(e=>{const t=n(e);a&&(a.innerText=t)}));const c=_("div");return A(c).add("plus-minus-button"),c.appendChild(r),c.appendChild(a),c.appendChild(o),c}const J=()=>{const e=function(e){const{rows:t,columns:n,gridEnabled:o,coloringMode:r,leftEyeColor:a,rightEyeColor:c,increaseSpeedLevel:i}=e;return{rows:t,columns:n,gridEnabled:o,coloringMode:r,leftEyeColor:a,rightEyeColor:c,increaseSpeedLevel:i}}(x());var t,n;t=i,n=JSON.stringify(e),window.localStorage.setItem(t,n)};const Y=()=>{const e=(t=i,window.localStorage.getItem(t));var t;null!=e&&k({...JSON.parse(e)})};const Z=[b,E],V=e=>{let t;switch(e){case E:t="shapes";break;case b:t="cells"}return`Color by ${t}`},X=()=>{const{coloringMode:e}=x(),t=Z.indexOf(e);k({coloringMode:Z[(t+1)%Z.length]})};function Q(){const{coloringMode:e}=x(),t=P(V(e),X);return I(["coloringMode"],(e=>{let{coloringMode:n}=e;t&&(t.innerText=V(n))})),t}const ee=e=>"Speed level is "+(e?"unlocked":"locked");function te(){const{increaseSpeedLevel:e}=x(),t=P(ee(e),(()=>{const{increaseSpeedLevel:e}=x();k({increaseSpeedLevel:!e})}));return I(["increaseSpeedLevel"],(e=>{let{increaseSpeedLevel:n}=e;t&&(t.innerText=ee(n))})),t}function ne(){const e=z();return e.appendChild($("Lazy eye blocks")),e.appendChild(function(){const e=P("New Game",(()=>{k({appState:m,gameState:S})}));return I(["gameState"],(t=>{let{gameState:n}=t;e&&(e.innerText=(n===f?"New":"Continue")+" game")})),e}()),e.appendChild(P("Settings",(()=>R(l)))),e}const oe=["T","J","L","S","Z","O","I"],re={T:[[[0,0],[-1,0],[1,0],[0,-1]],[[0,0],[0,-1],[0,1],[1,0]],[[0,0],[-1,0],[0,1],[1,0]],[[0,0],[0,-1],[-1,0],[0,1]]],L:[[[0,-1],[0,0],[0,1],[1,1]],[[-1,0],[0,0],[1,0],[1,-1]],[[-1,-1],[0,-1],[0,0],[0,1]],[[-1,0],[-1,1],[0,0],[1,0]]],J:[[[-1,1],[0,1],[0,0],[0,-1]],[[-1,0],[0,0],[1,0],[1,1]],[[1,-1],[0,-1],[0,0],[0,1]],[[-1,-1],[-1,0],[0,0],[1,0]]],Z:[[[-1,-1],[0,-1],[0,0],[1,0]],[[1,-1],[1,0],[0,0],[0,1]]],S:[[[1,-1],[0,-1],[0,0],[-1,0]],[[0,-1],[0,0],[1,0],[1,1]]],O:[[[-1,-1],[-1,0],[0,-1],[0,0]]],I:[[[0,-2],[0,-1],[0,0],[0,1]],[[-2,0],[-1,0],[0,0],[1,0]]]},ae=(e,t)=>{const n=[];for(let o=0;o<t;o+=1){const t=[];for(let n=0;n<e;n+=1)t.push(0);n.push(t)}return n},ce=(e,t,n)=>{const o=e.length,r=e[0].length,a=t-r,c=n-o,i=ae(t,n);for(let s=n-1;s>=0;s-=1)for(let n=t-1;n>=0;n-=1){const t=s-c,l=n-a;l>=0&&l<r&&(t>=0&&t<o)&&(i[s][n]=e[s-c][n-a])}return i},ie=()=>{const{rows:e,columns:t,gameBoard:n,gameCanvas:{width:o,height:r}}=x(),a=Math.floor((r-10)/e),c=Math.floor((o-10)/a),i=Math.min(t,c);M({yMargin:(r-a*e)/2,xMargin:(o-a*i)/2,gridFacetSize:a,columns:i,gameBoard:ce(n,i,e)})},se=()=>Math.random()<.5?1:2,le=e=>{switch(e){case b:return[1,1,1,1].map(se);case E:const e=se();return[e,e,e,e];default:return null}},de=(e,t)=>((e,t,n)=>({type:e,x:Math.floor(t/2),y:-4,currentShapeFormIndex:0,possibleShapeForms:[...re[e]],colors:le(n)}))(oe[Math.floor(Math.random()*oe.length)],e,t),ue=e=>{const t=1500-75*e;return t<100?100:t},ge=e=>e*e,pe=()=>{const{gameState:e}=x();switch(e){case f:case w:k({gameState:S});break;case S:k({gameState:w})}},me=()=>{const{animationId:e,gameLogicId:t,gameLogicTimeoutId:n}=x();cancelAnimationFrame(e),cancelAnimationFrame(t),clearInterval(n),M({animationId:null,gameLogicId:null,gameLogicTimeoutId:null})},he=()=>{const{columns:e,rows:t,coloringMode:n}=x();M({score:0,linesCleared:0,nextShape:de(e,n),currentShape:de(e,n),gameBoard:ae(e,t)})},fe=()=>{confirm("Do you want to reset game?")&&(me(),he(),k({appState:s,gameState:f}))},Se=e=>{const{x:t,y:n,possibleShapeForms:o,currentShapeFormIndex:r}=e;return o[r].map((e=>[t+e[0],n+e[1]]))},we=(e,t)=>{const n=t[0].length,o=t.length;return Se(e).some((e=>{let[r,a]=e;return r>n-1||r<0||a>o-1||a>0&&0!==t[a][r]}))};function ve(e,t,n,o){e.x+=n,e.y+=o,we(e,t)&&(e.x-=n,e.y-=o)}const Ee=(e,t)=>ve(e,t,-1,0),be=(e,t)=>ve(e,t,1,0),Ce=(e,t)=>{for(;!we(e,t);)e.y+=1;e.y-=1},Le=(e,t)=>{const{possibleShapeForms:n,currentShapeFormIndex:o}=e;o===n.length-1?e.currentShapeFormIndex=0:e.currentShapeFormIndex+=1,we(e,t)&&(e.currentShapeFormIndex=o)},Te=e=>{const{gameBoard:t,currentShape:n}=x();e(n,t)},ye=e=>{const{appState:t,gameState:n,gameBoard:o,gridEnabled:r,currentShape:a}=x(),{keyCode:c}=e;switch(c){case 80:case 19:pe();break;case 71:k({gridEnabled:!r});break;case 27:case 81:fe()}if(t===m&&n===S)switch(c){case 37:case 72:Ee(a,o);break;case 39:case 76:be(a,o);break;case 38:case 75:Le(a,o);break;case 40:case 74:ve(a,o,0,1);break;case 32:Ce(a,o)}};const ke=.9;function Me(){const{gameCanvas:e}=x(),t=document.querySelector(".game-canvas-wrapper"),{width:n,height:o}=t.getBoundingClientRect();e.setAttribute("width",n*ke),e.setAttribute("height",o*ke),e.style.width=`width: ${n*ke}px;`,e.style.height=`height: ${o*ke}px`}const xe=e=>{const{speedLevel:t}=x();if(t+e<0)return;const n=t+e;k({speedLevel:n,gameLogicTicksInterval:ue(n)})},Ie=()=>{const e=_("div");return e.innerText=0,e.setAttribute("id","speed-level-indicator"),I(["speedLevel"],(t=>{let{speedLevel:n}=t;e&&(e.innerText=n)})),e};const Re=e=>`Level: ${e}`,Be=e=>`Score: ${e}`;function Oe(){const{score:e,speedLevel:t}=x(),n=D(Be(e)),o=D(Re(t));return I(["score","speedLevel"],(e=>{let{score:t,speedLevel:r}=e;n.innerHTML=Be(t),o.innerHTML=Re(r)})),z([$("Game over"),n,o,P("Back",(()=>R(s)))])}const Ae=e=>{const{rows:t,columns:n,gameBoard:o}=x();t+e>=4&&k({rows:t+e,gameBoard:ce(o,n,t+e),shouldCallResizeOnDraw:!0})},_e=e=>{const{rows:t,columns:n,gameBoard:o}=x();n+e>=4&&k({columns:n+e,gameBoard:ce(o,n+e,t),shouldCallResizeOnDraw:!0})};function Fe(){const e=W((()=>Ae(1)),(()=>Ae(-1)),(e=>e.rows)),t=W((()=>_e(1)),(()=>_e(-1)),(e=>e.columns));return z([$("Board size"),D("Rows"),e,D("Columns"),t,P("Back",(()=>R(l)))])}const Ne=()=>{document.querySelectorAll("button").forEach((e=>e.blur()))};function ze(e,t){const n=_("button");return A(n).add("action-button"),n.onclick=()=>{t(),Ne()},n.innerHTML=e,n}const Pe=()=>{k({appState:s,gameState:w})};function $e(e){const t=_("div");return A(t).add("stat-info"),t.innerHTML=e,t}const De=e=>{switch(e){case S:return"Pause";case f:case w:return"Play"}return null};const Ge=1/r,He=(e,n,o)=>{switch(e){case 1:return n;case 2:return o;default:return t}};function je(e,t,n,o,r,a,c,i){Se(n).forEach(((s,l)=>{let[d,u]=s;if(u<0)return;const g=o+d*a,p=r+u*a,m=n.colors[l];e.fillStyle=t||He(m,c,i),e.fillRect(g,p,a+1,a+1)}))}var Ue=function e(){const{rows:i,columns:s,yMargin:l,xMargin:d,gameBoard:u,nextShape:g,speedLevel:p,gridEnabled:m,leftEyeColor:h,linesCleared:f,currentShape:S,rightEyeColor:w,gridFacetSize:v,gameCanvasWrapper:E,canvasContext:b,gameCanvas:C,increaseSpeedLevel:L,shouldCallResizeOnDraw:T}=x(),{height:y}=E.getBoundingClientRect();if(Math.abs(C.height-y)>100&&(Me(),ie()),T&&window.onresize(),b.clearRect(0,0,C.width,C.height),function(e,n,o,r,a,c,i){const s=n.length,l=n[0].length;e.fillStyle=t,e.fillRect(o,r,l*a,s*a);for(let t=0;t<s;t+=1)for(let s=0;s<l;s+=1)e.fillStyle=He(n[t][s],c,i),e.fillRect(o+s*a,r+t*a,a+1,a+1)}(b,u,d,l,v,h,w),function(e,t,o,r,c,i){e.strokeStyle=n,e.lineWidth=a,e.strokeRect(r,c,t*i,o*i)}(b,s,i,d,l,v),S&&je(b,null,S,d,l,v,h,w),g){!function(e,t,n,a,c,i,s){e.scale(r,r),je(e,o,{...t,x:3,y:3},n*Ge,a*Ge,c,i,s),e.setTransform(1,0,0,1,0,0)}(b,S.y<0?S:g,d,l,v,h,w)}m&&function(e,t,o,r,c,i,s,l){e.strokeStyle=n,e.lineWidth=a,e.beginPath();for(let n=1;n<t;n+=1){const t=r+n*i;e.moveTo(t,c),e.lineTo(t,l-c)}for(let t=o-1;t>0;t-=1){const n=c+t*i;e.moveTo(r,n),e.lineTo(s-r,n)}e.closePath(),e.stroke()}(b,s,i,d,l,v,C.width,C.height),L&&function(e,t,n,o,r,a,i,s,l,d){const u=n*s,g=t*s,p=g*(d/ge(l));e.beginPath(),e.lineWidth=c,e.strokeStyle=o,e.moveTo(a,i+u),e.lineTo(a+g,i+u),e.closePath(),e.stroke(),e.beginPath(),e.strokeStyle=r,e.moveTo(a,i+u),e.lineTo(a+p,i+u),e.closePath(),e.stroke()}(b,s,i,h,w,d,l,v,p,f),M({animationId:N(e),shouldCallResizeOnDraw:!1})};var qe=function e(){const{gameLogicTicksInterval:t}=x(),n=setTimeout((()=>{const{score:t,rows:o,columns:r,gameState:a,gameBoard:c,nextShape:i,speedLevel:s,currentShape:l,linesCleared:d,coloringMode:u,increaseSpeedLevel:g}=x();if(a===S){if(l.y+=1,we(l,c)){l.y-=1,Se(l).forEach(((e,t)=>{let[n,a]=e;n<0||a<0||n>r||a>o||(c[a][n]=l.colors[t])}));if(c[0].some((e=>0!==e)))return void k({gameState:v});const e=(e=>{let t=0;for(let n=e.length-1;n>0;n-=1)if(e[n].every((e=>0!==e))){t+=1;for(let t=n;t>=0;t-=1)e[t]=t-1<0?e[t].fill(0):[...e[t-1]];n+=1}return t})(c);if(e>0){const n={},o=t+(4===e?10:e),r=d+e,a=(p=r,Math.floor(Math.sqrt(p))+1);s<a&&Object.assign(n,{speedLevel:g?a:s,gameLogicTicksInterval:ue(a)}),Object.assign(n,{score:o}),M({linesCleared:r}),k({...n})}M({currentShape:i,nextShape:de(r,u)})}var p;M({gameLogicTimeoutId:n,gameLogicId:N(e)})}}),t)};var Ke=e=>{const{rows:t,columns:n,gameState:o}=e;switch(o){case f:he();break;case S:N(Ue),N(qe);break;case w:me();break;case v:me(),k({appState:h,gameState:f});break;default:throw new Error(`Unsupported game state: ${o}`)}};function We(){document.addEventListener("keydown",ye,!1),I(["gameState","appState"],(e=>Ke(e)))}function Je(){const e=function(){const e=_("canvas");A(e).add("game-canvas"),M({gameCanvas:e,canvasContext:e.getContext("2d")});const t=_("div");return A(t).add("game-canvas-wrapper"),t.appendChild(e),M({gameCanvasWrapper:t}),window.onresize=()=>{Me(),ie()},t}();(e=>{const t=new Hammer(e);t.get("swipe").set({direction:Hammer.DIRECTION_ALL}),t.on("swipeup",(()=>Te(Le))),t.on("swipeleft",(()=>Te(Ee))),t.on("swiperight",(()=>Te(be))),t.on("swipedown",(()=>Te(Ce)))})(e);const t=_("div");A(t).add("action-button-row"),t.appendChild(function(){const{gameState:e}=x(),t=ze(De(e),pe);return I(["gameState"],(e=>{let{gameState:n}=e;t.innerHTML=De(n)})),t}()),t.appendChild(ze("Restart",fe)),t.appendChild(ze("Back",Pe)),t.appendChild(function(){const e=$e("score: 0");return I(["score"],(t=>{let{score:n}=t;e.innerText=`score: ${n}`})),e}()),t.appendChild(function(){const e=$e("level: 0");return I(["speedLevel"],(t=>{let{speedLevel:n}=t;e.innerText=`level: ${n}`})),e}());const n=_("div");return A(n).add("game-container"),n.appendChild(t),n.appendChild(e),We(),n}window.onload=()=>{O(s,{[s]:ne(),[l]:z([$("Settings"),q(),Q(),P("Speed level",(()=>R(d))),P("Left eye color",(()=>R(u))),P("Right eye color",(()=>R(g))),P("Board size",(()=>R(p))),P("Save settings",J),P("Load settings",Y),P("Back",(()=>R(s)))]),[d]:z([$("Speed level"),Ie(),P("Faster",(()=>xe(1))),P("Slower",(()=>xe(-1))),P("Back",(()=>R(l))),te()]),[u]:z([$("Left eye color"),K((e=>e.leftEyeColor)),j((e=>k({leftEyeColor:e}))),P("Back",(()=>R(l)))]),[g]:z([$("Right eye color"),K((e=>e.rightEyeColor)),j((e=>k({rightEyeColor:e}))),P("Back",(()=>R(l)))]),[p]:Fe(),[m]:Je(),[h]:Oe()})}}();